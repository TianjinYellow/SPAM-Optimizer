[32m2025-01-14 10:37:17.275[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m209[0m - [1mUsing dist with rank 0 (only rank 0 will log)[0m
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m210[0m - [1m****************************************[0m
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m211[0m - [1mStarting training with the arguments[0m
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mmodel_config                   configs/llama_60m.json[0m
model_config                   configs/llama_60m.json
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1muse_hf_model                   False[0m
use_hf_model                   False
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mcontinue_from                  None[0m
continue_from                  None
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mbatch_size                     128[0m
batch_size                     128
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mgradient_accumulation          4[0m
gradient_accumulation          4
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mtotal_batch_size               512[0m
total_batch_size               512
[32m2025-01-14 10:37:17.276[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mmax_length                     256[0m
max_length                     256
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1moptimizer                      SPAM[0m
optimizer                      SPAM
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mlr                             0.001[0m
lr                             0.001
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mscheduler                      cosine[0m
scheduler                      cosine
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mmin_lr_ratio                   0.1[0m
min_lr_ratio                   0.1
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mactivation_checkpointing       False[0m
activation_checkpointing       False
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mweight_decay                   0.0[0m
weight_decay                   0.0
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mwarmup_steps                   1000[0m
warmup_steps                   1000
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1meval_every                     1000[0m
eval_every                     1000
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mnum_training_steps             20000[0m
num_training_steps             20000
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mmax_train_tokens               None[0m
max_train_tokens               None
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1msave_every                     2000[0m
save_every                     2000
[32m2025-01-14 10:37:17.277[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1msave_dir                       /scratch-shared/HTJ2/checkpoints/new0_9390469[0m
save_dir                       /scratch-shared/HTJ2/checkpoints/new0_9390469
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mtags                           None[0m
tags                           None
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mdtype                          bfloat16[0m
dtype                          bfloat16
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mworkers                        8[0m
workers                        8
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mseed                           0[0m
seed                           0
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mname                           test[0m
name                           test
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mmodel_type                     llama[0m
model_type                     llama
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mgrad_clipping                  0.0[0m
grad_clipping                  0.0
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mbeta1                          0.0[0m
beta1                          0.0
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mgalore_scale                   1.0[0m
galore_scale                   1.0
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1msingle_gpu                     False[0m
single_gpu                     False
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mload_local                     False[0m
load_local                     False
[32m2025-01-14 10:37:17.278[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mwarmup_epoch                   150[0m
warmup_epoch                   150
[32m2025-01-14 10:37:17.279[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mthreshold                      5000.0[0m
threshold                      5000.0
[32m2025-01-14 10:37:17.279[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mgrad_accu_steps                20[0m
grad_accu_steps                20
[32m2025-01-14 10:37:17.279[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mdensity                        1.0[0m
density                        1.0
[32m2025-01-14 10:37:17.279[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m213[0m - [1mupdate_gap                     500[0m
update_gap                     500
[32m2025-01-14 10:37:17.279[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m215[0m - [1m****************************************[0m
Resolving data files: 100%|██████████████████████████████████████████████████████████████████████| 1024/1024 [00:02<00:00, 438.07it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 502511.68it/s]
[32m2025-01-14 10:37:25.261[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m228[0m - [1mShuffling data with seed 42[0m
/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/huggingface_hub/file_download.py:797: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
[34m[1mwandb[0m: [33mWARNING[0m Saving files without folders. If you want to preserve subdirectories pass base_path to wandb.save, i.e. wandb.save("/mnt/folder/file.h5", base_path="/mnt")
Update steps:   0%|                                   | 0/20000 [00:00<?, ?it/s][32m2025-01-14 10:37:26.961[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m345[0m - [1m
LlamaForCausalLM(
  (model): LlamaModel(
    (embed_tokens): Embedding(32000, 512, padding_idx=31999)
    (layers): ModuleList(
      (0-7): 8 x LlamaDecoderLayer(
        (self_attn): LlamaAttention(
          (q_proj): Linear(in_features=512, out_features=512, bias=False)
          (k_proj): Linear(in_features=512, out_features=512, bias=False)
          (v_proj): Linear(in_features=512, out_features=512, bias=False)
          (o_proj): Linear(in_features=512, out_features=512, bias=False)
          (rotary_emb): LlamaRotaryEmbedding()
        )
        (mlp): LlamaMLP(
          (gate_proj): Linear(in_features=512, out_features=1376, bias=False)
          (down_proj): Linear(in_features=1376, out_features=512, bias=False)
          (up_proj): Linear(in_features=512, out_features=1376, bias=False)
          (act_fn): SiLUActivation()
        )
        (input_layernorm): LlamaRMSNorm()
        (post_attention_layernorm): LlamaRMSNorm()
      )
    )
    (norm): LlamaRMSNorm()
  )
  (lm_head): Linear(in_features=512, out_features=32000, bias=False)
)
[0m
[32m2025-01-14 10:37:26.962[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m346[0m - [1mTotal params: 58.07M[0m
[32m2025-01-14 10:37:26.962[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m347[0m - [1mTrainable params: 58.07M[0m
[32m2025-01-14 10:37:26.962[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m350[0m - [1mSaving model to /scratch-shared/HTJ2/checkpoints/new0_9390469 every 2000 update steps[0m
/gpfs/home2/huangti/SPAM_v2/galore_torch/SPAM.py:104: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use `torch.optim.AdamW` instead, or set `no_deprecation_warning=True` to disable this warning.
  warnings.warn(
density 1.0
/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/autograd/graph.py:825: UserWarning: cuDNN SDPA backward got grad_output.strides() != output.strides(), attempting to materialize a grad_output with matching strides... (Triggered internally at /opt/conda/conda-bld/pytorch_1728945379270/work/aten/src/ATen/native/cudnn/MHA.cpp:674.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass

loss at 4 2.625
Update steps:   2%|▌                      | 500/20000 [02:56<1:54:13,  2.85it/s]/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/optim/lr_scheduler.py:224: UserWarning: Detected call of `lr_scheduler.step()` before `optimizer.step()`. In PyTorch 1.1.0 and later, you should call them in the opposite order: `optimizer.step()` before `lr_scheduler.step()`.  Failure to do this will result in PyTorch skipping the first value of the learning rate schedule. See more details at https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate

loss at 404 1.90625

loss at 804 1.75

loss at 1204 1.5703125

loss at 1604 1.453125
lr 0.000498
lr 0.000498
Mask overlap ratio: 1.00
Mask Update
  warnings.warn(
/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/optim/lr_scheduler.py:240: UserWarning: The epoch parameter in `scheduler.step()` was not necessary and is being deprecated where possible. Please use `scheduler.step()` to step the scheduler. During the deprecation, if epoch is different from None, the closed form is used instead of the new chainable form, where available. Please open an issue if you are unable to replicate your use case: https://github.com/pytorch/pytorch/issues/new/choose.
  warnings.warn(EPOCH_DEPRECATION_WARNING, UserWarning)

loss at 2004 1.3515625
Update steps:   5%|█                     | 1000/20000 [05:47<1:50:32,  2.86it/s][32m2025-01-14 10:43:14.117[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 1000[0m

loss at 2404 1.3125

loss at 2804 1.2109375

loss at 3204 1.1484375

loss at 3604 1.1171875
lr 0.000998
lr 0.000998
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|██████████████████████████████████████████████████████████████████████| 1024/1024 [00:01<00:00, 547.22it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 515045.84it/s]
[32m2025-01-14 10:43:20.057[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 5.94 seconds[0m
[32m2025-01-14 10:43:20.059[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 5.94 seconds[0m
[32m2025-01-14 10:43:54.449[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 1000: 4.284367561340332,tokens_seen: 99979486[0m

loss at 4004 1.0703125
Update steps:  10%|██▏                   | 2000/20000 [12:09<1:44:46,  2.86it/s][32m2025-01-14 10:49:36.833[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 2000[0m

loss at 4404 1.0546875

loss at 4804 1.0390625

loss at 5204 1.015625

loss at 5604 1.0
lr 0.0009984752861521339
lr 0.0009984752861521339
Mask overlap ratio: 1.00
Mask Update

loss at 6004 0.99609375

loss at 6404 0.984375

loss at 6804 0.984375

loss at 7204 1.0

loss at 7604 0.9609375
lr 0.0009938870559575525
lr 0.0009938870559575525
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|██████████████████████████████████████████████████████████████████████| 1024/1024 [00:02<00:00, 407.34it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 480260.24it/s]
[32m2025-01-14 10:49:42.504[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 5.67 seconds[0m
[32m2025-01-14 10:49:42.505[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 5.67 seconds[0m
[32m2025-01-14 10:50:14.792[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 2000: 3.8616740703582764,tokens_seen: 199880081[0m

loss at 8004 0.98046875
Update steps:  15%|███▎                  | 3000/20000 [18:29<1:39:17,  2.85it/s][32m2025-01-14 10:55:56.671[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 3000[0m

loss at 8404 0.984375

loss at 8804 0.9765625

loss at 9204 0.97265625

loss at 9604 0.9375
lr 0.0009862666270752276
lr 0.0009862666270752276
Mask overlap ratio: 1.00
Mask Update

loss at 10004 0.9609375

loss at 10404 0.921875

loss at 10804 0.93359375

loss at 11204 0.9453125

loss at 11604 0.91796875
lr 0.0009756660547614391
lr 0.0009756660547614391
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 485197.39it/s]
Resolving data files: 100%|█████████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 1185.86it/s]
[32m2025-01-14 10:56:00.885[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 4.21 seconds[0m
[32m2025-01-14 10:56:00.886[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 4.21 seconds[0m
[32m2025-01-14 10:56:34.281[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 3000: 3.7208151817321777,tokens_seen: 299903185[0m

loss at 12004 0.92578125
Update steps:  20%|████▍                 | 4000/20000 [24:51<1:33:04,  2.86it/s][32m2025-01-14 11:02:19.255[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 4000[0m

loss at 12404 0.9296875

loss at 12804 0.91796875

loss at 13204 0.9296875

loss at 13604 0.92578125
lr 0.0009621577516739283
lr 0.0009621577516739283
Mask overlap ratio: 1.00
Mask Update

loss at 14004 0.8984375

loss at 14404 0.9296875

loss at 14804 0.91796875

loss at 15204 0.9140625

loss at 15604 0.921875
lr 0.0009458339932200227
lr 0.0009458339932200227
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|█████████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 1236.20it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 548597.18it/s]
[32m2025-01-14 11:02:23.298[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 4.04 seconds[0m
[32m2025-01-14 11:02:23.300[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 4.04 seconds[0m
[32m2025-01-14 11:02:55.500[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 4000: 3.6383650302886963,tokens_seen: 399934286[0m

loss at 16004 0.9296875
Update steps:  25%|█████▌                | 5000/20000 [31:10<1:27:18,  2.86it/s][32m2025-01-14 11:08:37.880[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 5000[0m

loss at 16404 0.9140625

loss at 16804 0.93359375

loss at 17204 0.9140625

loss at 17604 0.90625
lr 0.0009268062872220353
lr 0.0009268062872220353
Mask overlap ratio: 1.00
Mask Update

loss at 18004 0.88671875

loss at 18404 0.88671875

loss at 18804 0.91796875

loss at 19204 0.91015625

loss at 19604 0.9140625
lr 0.0009052046122057728
lr 0.0009052046122057728
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|██████████████████████████████████████████████████████████████████████| 1024/1024 [00:01<00:00, 821.91it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 516781.05it/s]
[32m2025-01-14 11:08:42.971[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 5.09 seconds[0m
[32m2025-01-14 11:08:42.972[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 5.09 seconds[0m
[32m2025-01-14 11:09:15.544[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 5000: 3.5815930366516113,tokens_seen: 499986358[0m

loss at 20004 0.90625
Update steps:  30%|██████▌               | 6000/20000 [37:30<1:21:23,  2.87it/s][32m2025-01-14 11:14:57.993[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 6000[0m

loss at 20404 0.8671875

loss at 20804 0.91015625

loss at 21204 0.90625

loss at 21604 0.8984375
lr 0.0008811765295154064
lr 0.0008811765295154064
Mask overlap ratio: 1.00
Mask Update

loss at 22004 0.90625

loss at 22404 0.91015625

loss at 22804 0.91015625

loss at 23204 0.89453125

loss at 23604 0.890625
lr 0.0008548861753198666
lr 0.0008548861753198666
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 490741.24it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 474949.39it/s]
[32m2025-01-14 11:15:01.360[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 3.37 seconds[0m
[32m2025-01-14 11:15:01.361[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 3.37 seconds[0m
[32m2025-01-14 11:15:33.718[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 6000: 3.537757396697998,tokens_seen: 600040686[0m

loss at 24004 0.91015625
Update steps:  35%|███████▋              | 7000/20000 [43:48<1:15:47,  2.86it/s][32m2025-01-14 11:21:15.631[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 7000[0m

loss at 24404 0.90234375

loss at 24804 0.90234375

loss at 25204 0.9296875

loss at 25604 0.890625
lr 0.0008265131393963775
lr 0.0008265131393963775
Mask overlap ratio: 1.00
Mask Update

loss at 26004 0.90625

loss at 26404 0.8671875

loss at 26804 0.90625

loss at 27204 0.8984375

loss at 27604 0.859375
lr 0.0007962512383501763
lr 0.0007962512383501763
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 505052.60it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 488230.91it/s]
[32m2025-01-14 11:21:19.057[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 3.43 seconds[0m
[32m2025-01-14 11:21:19.059[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 3.43 seconds[0m
[32m2025-01-14 11:21:51.823[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 7000: 3.5034680366516113,tokens_seen: 700029429[0m

loss at 28004 0.89453125
Update steps:  40%|████████▊             | 8000/20000 [50:07<1:09:48,  2.86it/s][32m2025-01-14 11:27:34.533[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 8000[0m

loss at 28404 0.8828125

loss at 28804 0.8984375

loss at 29204 0.85546875

loss at 29604 0.859375
lr 0.0007643071916505726
lr 0.0007643071916505726
Mask overlap ratio: 1.00
Mask Update

loss at 30004 0.8515625

loss at 30404 0.8984375

loss at 30804 0.890625

loss at 31204 0.89453125

loss at 31604 0.87109375
lr 0.000730899209527362
lr 0.000730899209527362
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 454205.51it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 514737.21it/s]
[32m2025-01-14 11:27:37.905[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 3.37 seconds[0m
[32m2025-01-14 11:27:37.906[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 3.37 seconds[0m
[32m2025-01-14 11:28:10.902[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 8000: 3.4764652252197266,tokens_seen: 800038852[0m

loss at 32004 0.859375
Update steps:  45%|█████████▉            | 9000/20000 [56:25<1:04:02,  2.86it/s][32m2025-01-14 11:33:52.768[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 9000[0m

loss at 32404 0.88671875

loss at 32804 0.890625

loss at 33204 0.87890625

loss at 33604 0.87109375
lr 0.0006962555023736943
lr 0.0006962555023736943
Mask overlap ratio: 1.00
Mask Update

loss at 34004 0.8515625

loss at 34404 0.88671875

loss at 34804 0.87890625

loss at 35204 0.8359375

loss at 35604 0.8828125
lr 0.0006606127218376856
lr 0.0006606127218376856
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 487565.82it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 109806.39it/s]
[32m2025-01-14 11:33:56.723[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 3.95 seconds[0m
[32m2025-01-14 11:33:56.725[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 3.96 seconds[0m
[32m2025-01-14 11:34:29.854[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 9000: 3.451176881790161,tokens_seen: 899981426[0m

loss at 36004 0.84375
Update steps:  50%|██████████▌          | 10000/20000 [1:02:44<58:11,  2.86it/s][32m2025-01-14 11:40:12.110[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 10000[0m

loss at 36404 0.87890625

loss at 36804 0.88671875

loss at 37204 0.85546875

loss at 37604 0.8515625
lr 0.0006242143442517014
lr 0.0006242143442517014
Mask overlap ratio: 1.00
Mask Update

loss at 38004 0.859375

loss at 38404 0.86328125

loss at 38804 0.83203125

loss at 39204 0.86328125

loss at 39604 0.8671875
lr 0.0005873090074421229
lr 0.0005873090074421229
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 459109.28it/s]
Resolving data files: 100%|██████████████████████████████████████████████████████████████████████| 1024/1024 [00:01<00:00, 974.49it/s]
[32m2025-01-14 11:40:16.174[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 4.06 seconds[0m
[32m2025-01-14 11:40:16.176[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 4.07 seconds[0m
[32m2025-01-14 11:40:48.291[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 10000: 3.430018901824951,tokens_seen: 999938455[0m

loss at 40004 0.8671875
Update steps:  55%|███████████▌         | 11000/20000 [1:09:03<52:19,  2.87it/s][32m2025-01-14 11:46:30.214[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 11000[0m

loss at 40404 0.8671875

loss at 40804 0.87890625

loss at 41204 0.85546875

loss at 41604 0.86328125
lr 0.0005501488122808787
lr 0.0005501488122808787
Mask overlap ratio: 1.00
Mask Update

loss at 42004 0.85546875

loss at 42404 0.84375

loss at 42804 0.8515625

loss at 43204 0.83984375

loss at 43604 0.8671875
lr 0.0005129876005808627
lr 0.0005129876005808627
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 473587.75it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 502864.69it/s]
[32m2025-01-14 11:46:33.461[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 3.25 seconds[0m
[32m2025-01-14 11:46:33.462[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 3.25 seconds[0m
[32m2025-01-14 11:47:06.023[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 11000: 3.4102635383605957,tokens_seen: 1099986729[0m

loss at 44004 0.8515625
Update steps:  60%|████████████▌        | 12000/20000 [1:15:21<46:37,  2.86it/s][32m2025-01-14 11:52:48.478[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m496[0m - [1mPerforming evaluation at step 12000[0m

loss at 44404 0.8359375

loss at 44804 0.86328125

loss at 45204 0.86328125

loss at 45604 0.875
lr 0.0004760792210989586
lr 0.0004760792210989586
Mask overlap ratio: 1.00
Mask Update

loss at 46004 0.8828125

loss at 46404 0.86328125

loss at 46804 0.86328125

loss at 47204 0.83203125

loss at 47604 0.86328125
lr 0.0004396757954916322
lr 0.0004396757954916322
Mask overlap ratio: 1.00
Mask Update
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 475738.51it/s]
Resolving data files: 100%|███████████████████████████████████████████████████████████████████| 1024/1024 [00:00<00:00, 475633.14it/s]
[32m2025-01-14 11:52:51.900[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m105[0m - [1mLoaded validation dataset in 3.42 seconds[0m
[32m2025-01-14 11:52:51.902[0m | [1mINFO    [0m | [36m__main__[0m:[36mevaluate_model[0m:[36m121[0m - [1mEval set prepared in 3.42 seconds[0m
[32m2025-01-14 11:53:24.425[0m | [1mINFO    [0m | [36m__main__[0m:[36mmain[0m:[36m508[0m - [1mEval loss at step 12000: 3.3930020332336426,tokens_seen: 1199964331[0m

loss at 48004 0.83203125
Update steps:  64%|█████████████▍       | 12801/20000 [1:20:32<42:14,  2.84it/s]Traceback (most recent call last):

loss at 48404 0.86328125

loss at 48804 0.8515625

loss at 49204 0.84765625

loss at 49604 0.86328125
lr 0.0004040259960683696
lr 0.0004040259960683696
Mask overlap ratio: 1.00
Mask Update

loss at 50004 0.8671875

loss at 50404 0.8359375

loss at 50804 0.8359375

loss at 51204 0.859375
  File "/gpfs/home2/huangti/SPAM_v2/torchrun_main.py", line 595, in <module>
    main(args)
  File "/gpfs/home2/huangti/SPAM_v2/torchrun_main.py", line 452, in main
    optimizer.step()
  File "/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/optim/lr_scheduler.py", line 137, in wrapper
    return func.__get__(opt, opt.__class__)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/optim/optimizer.py", line 487, in wrapper
    out = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/home2/huangti/SPAM_v2/galore_torch/SPAM.py", line 243, in step
    grad[mask]=grad[mask].sign()*torch.sqrt(exp_avg_sq1[mask]*self.thres)
               ^^^^^^^^^^^^^^^^^
KeyboardInterrupt
[rank0]: Traceback (most recent call last):
[rank0]:   File "/gpfs/home2/huangti/SPAM_v2/torchrun_main.py", line 595, in <module>
[rank0]:     main(args)
[rank0]:   File "/gpfs/home2/huangti/SPAM_v2/torchrun_main.py", line 452, in main
[rank0]:     optimizer.step()
[rank0]:   File "/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/optim/lr_scheduler.py", line 137, in wrapper
[rank0]:     return func.__get__(opt, opt.__class__)(*args, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/optim/optimizer.py", line 487, in wrapper
[rank0]:     out = func(*args, **kwargs)
[rank0]:           ^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/home/huangti/miniconda3/envs/spam/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
[rank0]:     return func(*args, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/gpfs/home2/huangti/SPAM_v2/galore_torch/SPAM.py", line 243, in step
[rank0]:     grad[mask]=grad[mask].sign()*torch.sqrt(exp_avg_sq1[mask]*self.thres)
[rank0]:                ^^^^^^^^^^^^^^^^^
[rank0]: KeyboardInterrupt
